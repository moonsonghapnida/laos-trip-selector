<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>라오스 비엔티안(1박) - 방비엥 (2박) C-Pack 빠른견적</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <style>
    html { font-size:15px;}
    body { font-family: 'Pretendard', 'Noto Sans KR', Arial, sans-serif; background: #f7f7fa; margin: 0; padding: 0; color: #222; font-size:1rem;}
    .container { max-width: 480px; margin: 32px auto; padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 2px 14px rgba(70, 85, 110, 0.12);}
    h1 { font-size: 1.15rem; font-weight: bold; text-align: center; margin-bottom: 24px; color: #14508e; letter-spacing: -1px;}
    .section { margin-bottom: 24px;}
    .section-label-row { display:flex; align-items:center; justify-content:space-between; margin-bottom:8px;}
    .section label { font-weight: 600; font-size: 0.98rem; color: #294a6b;}
    .person-desc { color:#b04d0c; font-size:0.85em; margin-top:5px; margin-bottom:-12px;}
    .toggle-group { display: flex; gap: 7px; flex-wrap: wrap; margin-top: 7px;}
    .toggle-btn { background: #f4f7fb; border: 1.2px solid #c5d4ee; border-radius: 10px; padding: 9px 0 7px 0; font-size: 1em; flex: 1 1 0; text-align: center; cursor: pointer; margin-bottom: 6px; min-width: 42px; transition: all 0.12s; position: relative;}
    .toggle-btn.selected { background: #296bb3; color: #fff; border-color: #14508e;}
    .option-list { margin-top: 6px;}
    .option-row { display: flex; align-items: center; justify-content: space-between; background:#f4f7fb; border:1px solid #d0deeb; border-radius:10px; padding: 7px 11px 6px 11px; margin-bottom: 7px; min-height:38px; font-size:0.97em; cursor:pointer; transition:background 0.13s, color 0.13s;}
    .option-row.selected { background: #296bb3; color: #fff;}
    .option-title { font-size: 0.97em; flex:2;}
    .option-unit { flex:1.4; font-size: 0.92em; color:#1849b9; text-align:center; transition:color .15s;}
    .option-row.selected .option-unit { color:#fff;}
    .option-total { flex:2.1; font-size: 0.95em; color:#d02b2b; font-weight:bold; text-align:right;}
    .option-row.selected .option-total { color: #ffe400; }
    .option-controls {display:flex; align-items:center; gap:7px;}
    .option-minus-btn {background:#e9e7ff; color:#2857a3; border:1px solid #bdd2ea; font-size:0.96em; border-radius:7px; padding:3px 8px; margin-right:4px; cursor:pointer;}
    .option-minus-btn:active {background:#c9e2ff;}
    .init-btn { font-size:0.92em; background:#e5eefe; border:1px solid #bdd2ea; border-radius:8px; color:#347; padding:4px 10px; cursor:pointer; margin-left:7px;}
    .init-btn:hover {background:#d1e8ff;}
    .room-single-btn {background:#fff7e0; color:#b26c18; border:1px solid #edd59c; font-size:0.92em; border-radius:7px; padding:4px 12px; margin-right:7px; cursor:pointer;}
    .room-single-btn:active {background:#ffeec4;}
    .result-section { margin: 20px 0 17px 0; padding: 13px 7px 8px 7px; background: #f4f6fa; border-radius: 12px; text-align: center; font-size: 1.05em; color: #14508e; font-weight: 600;}
    .result-section span { display: block; margin: 6px 0; font-weight: 500; color: #0c3d5a; font-size: 0.97em;}
    .contact-section { margin-bottom: 20px; background: #f9fafb; border-radius: 12px; padding: 12px 8px 7px 8px;}
    .contact-label { display: block; margin: 10px 0 5px 2px; color: #37629d; font-size: 0.96em; font-weight: 500;}
    .contact-input { width: 100%; padding: 8px 8px; border: 1px solid #bfd2e9; border-radius: 8px; font-size: 1em; margin-bottom: 3px; box-sizing: border-box; background: #f7fafc; font-family: 'Pretendard', 'Noto Sans KR', Arial, sans-serif; }
    textarea.contact-input { font-family: 'Pretendard', 'Noto Sans KR', Arial, sans-serif !important; resize: vertical;}
    .submit-btn { display: block; width: 100%; background: linear-gradient(90deg, #1466b6 88%, #25a6d1 100%); color: #fff; border: none; border-radius: 12px; padding: 13px 0; font-size: 1em; font-weight: 700; margin-top: 22px; cursor: pointer; transition: background 0.15s; letter-spacing: 0.5px; box-shadow: 0 2px 10px #4176a72c;}
    .submit-btn:active { background: #2a8ad1;}
    @media (max-width: 600px) {
      html {font-size:14px;}
      .container { max-width: 99vw; padding: 7vw 2vw;}
      .toggle-btn { font-size: 0.95em; min-width: 30px; padding: 8px 0 6px 0;}
      .option-row { font-size:0.93em; flex-direction:column; align-items:flex-start; gap:4px; padding: 7px 5px;}
      .option-unit, .option-total {text-align:left;}
      .init-btn {margin:6px 0 0 0; width:100%; text-align:center;}
      .room-single-btn {margin-bottom:7px;}
      .section-label-row {flex-direction:column; align-items:flex-start;gap:6px;}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>라오스 비엔티안(1박) - 방비엥 (2박) C-Pack 빠른견적</h1>
    <!-- 여행일자 선택 -->
    <div class="date-section">
      <label class="date-label" for="travelDate">여행일자 <span style="font-weight:400; color:#999; font-size:0.92em;">(출국일 기준, 필수)</span></label>
      <div class="date-input-wrap">
        <span class="date-icon">📅</span>
        <input type="date" id="travelDate" class="date-input" required>
      </div>
    </div>
    <!-- 1. 여행인원 -->
    <div class="section">
      <label>여행인원 <span style="font-weight:400; color:#999; font-size:0.92em;">(2~8명, 예약금 인당 60,000원)</span></label>
      <div class="toggle-group" id="personToggleGroup"></div>
      <div class="person-desc">9명 이상 단체 할인 적용 가능, <b>개별 문의</b></div>
    </div>
    <!-- 2. 가이드팩 -->
    <div class="section">
      <label>가이드팩 <span style="font-weight:400; color:#999; font-size:0.92em;">(단일 선택)</span></label>
      <div class="toggle-group" id="guideToggleGroup">
        <div class="toggle-btn" data-guide="kr" data-price="220">한국인 가이드<br><span style="font-size:0.91em; color:#55c;">$220/팀</span></div>
        <div class="toggle-btn" data-guide="local" data-price="0">현지인 가이드<br><span style="font-size:0.91em; color:#55c;">추가요금 없음</span></div>
      </div>
    </div>
    <!-- 3. 선택관광(방비엥) -->
    <div class="section">
      <div class="section-label-row">
        <label>선택관광 (방비엥)</label>
        <button type="button" class="init-btn" onclick="resetVangvieng()">초기화</button>
      </div>
      <div class="option-list" id="vangviengList"></div>
    </div>
    <!-- 4. 선택관광(케어팩) -->
    <div class="section">
      <div class="section-label-row">
        <label>선택관광 (케어팩)</label>
        <button type="button" class="init-btn" onclick="resetCare()">초기화</button>
      </div>
      <div class="option-list" id="careList"></div>
    </div>
    <!-- 5. 숙박팩 -->
    <div class="section">
      <div class="section-label-row">
        <label>숙박팩</label>
        <div>
          <button type="button" class="room-single-btn" onclick="addSingleRoom()">싱글룸 추가</button>
          <button type="button" class="init-btn" onclick="resetSingleRoom()">초기화</button>
        </div>
      </div>
      <div class="option-list" id="roomList"></div>
    </div>
    <!-- 결과 견적 -->
    <div class="result-section" id="resultSection">
      계약금 (한국에서 입금하실 금액): <span id="contractPrice">0원</span>
      <br>
      잔금 (현지에서 달러 지불하실 금액): <span id="usdPrice">$0</span>
    </div>
    <!-- 연락처 정보 입력란 -->
    <div class="contact-section">
      <label class="contact-label" for="contactName">대표자 성함 <span style="color:#d02b2b;">*</span></label>
      <input type="text" class="contact-input" id="contactName" placeholder="대표자 이름을 입력하세요" required>
      <label class="contact-label" for="contactPhone">연락 가능한 번호 또는 카카오톡 ID <span style="color:#d02b2b;">*</span></label>
      <input type="text" class="contact-input" id="contactPhone" placeholder="휴대폰 번호 또는 카카오톡 ID" required>
      <label class="contact-label" for="contactNote">기타 요청 사항 (선택)</label>
      <textarea class="contact-input" id="contactNote" rows="2" placeholder="예 ) 예약 관련 특이사항, 식단, 선택관광에 없는 추가 희망 일정 등"></textarea>
    </div>
    <button class="submit-btn" onclick="submitEstimate()">빠른 견적 보내기</button>
  </div>
  <script>
    // 옵션 데이터 및 상태변수
    const vangviengOptions = [
      {name: "열기구", price: 100},
      {name: "페러모터", price: 85},
      {name: "버기카", price: 18},
      {name: "짚라인", price: 20},
      {name: "롱테일보트", price: 10},
      {name: "시크릿라군", price: 10}
    ];
    const careOptions = [
      {name: "베트남식 이발관 풀코스 (90분)", price: 30},
      {name: "라오 허벌 테라피", price: 40},
      {name: "라오 전통 마사지 (2시간)", price: 25},
      {name: "라오 전통 마사지 (1시간)", price: 13},
      {name: "라오 오일 마사지 (2시간)", price: 35},
      {name: "라오 오일 마사지 (1시간)", price: 20}
    ];
    const roomOptions = [
      {name: "5성급 3박", price: 255000},
      {name: "4성급 3박", price: 159000},
      {name: "제가 예약할게요", price: 0}
    ];
    const MAX_PERSON = 8;
    const extraUsdByPerson = {8:95,7:105,6:118,5:137,4:165,3:211,2:305};
    let personCount = 2;

    // 인원 선택
    const personToggleGroup = document.getElementById("personToggleGroup");
    for(let i=2; i<=MAX_PERSON; i++) {
      const btn = document.createElement("div");
      btn.className = "toggle-btn" + (i===2 ? " selected" : "");
      btn.innerText = i + "명";
      btn.setAttribute('data-person', i);
      btn.onclick = function() {
        document.querySelectorAll("#personToggleGroup .toggle-btn").forEach(b=>b.classList.remove("selected"));
        btn.classList.add("selected");
        personCount = i;
        vangviengPersons = vangviengPersons.map((v,idx)=>vangviengChecked[idx]?personCount:0);
        carePersons = carePersons.map((v,idx)=>careChecked[idx]?personCount:0);
        updateRoomList();
        renderVangviengList();
        renderCareList();
        updateTotal();
        sendHeightToParent();
      }
      personToggleGroup.appendChild(btn);
    }

    // 가이드팩
    let guideType = "kr";
    let guidePrice = 220;
    document.querySelectorAll("#guideToggleGroup .toggle-btn").forEach(btn=>{
      btn.onclick = function(){
        document.querySelectorAll("#guideToggleGroup .toggle-btn").forEach(b=>b.classList.remove("selected"));
        btn.classList.add("selected");
        guideType = btn.getAttribute('data-guide');
        guidePrice = Number(btn.getAttribute('data-price'));
        updateTotal();
        sendHeightToParent();
      }
    });

    // 선택관광(방비엥)
    const vangviengList = document.getElementById("vangviengList");
    let vangviengChecked = Array(vangviengOptions.length).fill(false);
    let vangviengPersons = Array(vangviengOptions.length).fill(0);
    function renderVangviengList() {
      vangviengList.innerHTML = "";
      vangviengOptions.forEach((opt, idx) => {
        const row = document.createElement("div");
        row.className = "option-row" + (vangviengChecked[idx] ? " selected" : "");
        row.onclick = function(){
          vangviengChecked[idx] = !vangviengChecked[idx];
          vangviengPersons[idx] = vangviengChecked[idx] ? personCount : 0;
          renderVangviengList();
          updateTotal();
          sendHeightToParent();
        };
        const title = document.createElement("div");
        title.className = "option-title";
        title.innerText = opt.name;
        row.appendChild(title);
        const unit = document.createElement("div");
        unit.className = "option-unit";
        unit.innerText = vangviengChecked[idx] ? `$${opt.price} × ${vangviengPersons[idx]}명 = $${vangviengPersons[idx]*opt.price}` : `$${opt.price}/인당`;
        row.appendChild(unit);
        const controls = document.createElement("div");
        controls.className = "option-controls";
        if(vangviengChecked[idx]) {
          const minusBtn = document.createElement("button");
          minusBtn.type = "button";
          minusBtn.className = "option-minus-btn";
          minusBtn.innerText = "-1명";
          minusBtn.onclick = function(e){
            vangviengPersons[idx] = Math.max(0, vangviengPersons[idx]-1);
            if(vangviengPersons[idx]===0) vangviengChecked[idx]=false;
            renderVangviengList(); updateTotal(); sendHeightToParent();
            e.stopPropagation();
          };
          controls.appendChild(minusBtn);
          const total = document.createElement("div");
          total.className = "option-total";
          total.innerText = `$${vangviengPersons[idx]*opt.price} / 총 ${vangviengPersons[idx]}명`;
          controls.appendChild(total);
        }
        row.appendChild(controls);
        vangviengList.appendChild(row);
      });
    }
    window.resetVangvieng = function(){
      vangviengChecked = vangviengChecked.map(()=>false);
      vangviengPersons = vangviengPersons.map(()=>0);
      renderVangviengList(); updateTotal(); sendHeightToParent();
    }

    // 선택관광(케어팩)
    const careList = document.getElementById("careList");
    let careChecked = Array(careOptions.length).fill(false);
    let carePersons = Array(careOptions.length).fill(0);
    function renderCareList() {
      careList.innerHTML = "";
      careOptions.forEach((opt, idx) => {
        const row = document.createElement("div");
        row.className = "option-row" + (careChecked[idx] ? " selected" : "");
        row.onclick = function(){
          careChecked[idx] = !careChecked[idx];
          carePersons[idx] = careChecked[idx] ? personCount : 0;
          renderCareList(); updateTotal(); sendHeightToParent();
        };
        const title = document.createElement("div");
        title.className = "option-title";
        title.innerText = opt.name;
        row.appendChild(title);
        const unit = document.createElement("div");
        unit.className = "option-unit";
        unit.innerText = careChecked[idx] ? `$${opt.price} × ${carePersons[idx]}명 = $${carePersons[idx]*opt.price}` : `$${opt.price}/인당`;
        row.appendChild(unit);
        const controls = document.createElement("div");
        controls.className = "option-controls";
        if(careChecked[idx]) {
          const minusBtn = document.createElement("button");
          minusBtn.type = "button";
          minusBtn.className = "option-minus-btn";
          minusBtn.innerText = "-1명";
          minusBtn.onclick = function(e){
            carePersons[idx] = Math.max(0, carePersons[idx]-1);
            if(carePersons[idx]===0) careChecked[idx]=false;
            renderCareList(); updateTotal(); sendHeightToParent();
            e.stopPropagation();
          };
          controls.appendChild(minusBtn);
          const total = document.createElement("div");
          total.className = "option-total";
          total.innerText = `$${carePersons[idx]*opt.price} / 총 ${carePersons[idx]}명`;
          controls.appendChild(total);
        }
        row.appendChild(controls);
        careList.appendChild(row);
      });
    }
    window.resetCare = function(){
      careChecked = careChecked.map(()=>false);
      carePersons = carePersons.map(()=>0);
      renderCareList(); updateTotal(); sendHeightToParent();
    }

    // 숙박팩
    const roomList = document.getElementById("roomList");
    let selectedRoomIdx = null;
    let singleRoomAdd = 0;
    function updateRoomList(){
      roomList.innerHTML = "";
      let baseRoomCnt = Math.ceil(personCount/2);
      let totalRooms = baseRoomCnt + singleRoomAdd;
      roomOptions.forEach((opt, idx) => {
        const row = document.createElement("div");
        row.className = "option-row" + (selectedRoomIdx === idx ? " selected" : "");
        row.onclick = function(){
          if(selectedRoomIdx === idx) selectedRoomIdx = null;
          else selectedRoomIdx = idx;
          updateRoomList(); updateTotal(); sendHeightToParent();
        };
        const title = document.createElement("div");
        title.className = "option-title";
        title.innerText = opt.name;
        const unit = document.createElement("div");
        unit.className = "option-unit";
        unit.innerText = opt.price===0 ? "0원" : `${opt.price.toLocaleString()}원/객실`;
        const total = document.createElement("div");
        total.className = "option-total";
        total.innerText = opt.price===0 ? "0원" : `${(totalRooms*opt.price).toLocaleString()}원 / ${totalRooms}객실`;
        row.appendChild(title); row.appendChild(unit); row.appendChild(total);
        roomList.appendChild(row);
      });
    }
    window.addSingleRoom = function(){
      singleRoomAdd += 1; updateRoomList(); updateTotal(); sendHeightToParent();
    }
    window.resetSingleRoom = function(){
      singleRoomAdd = 0; selectedRoomIdx = null;
      updateRoomList(); updateTotal(); sendHeightToParent();
    }

    // 견적 계산
    function updateTotal(){
      let contract = personCount * 60000;
      let baseRoomCnt = Math.ceil(personCount/2);
      let totalRooms = baseRoomCnt + singleRoomAdd;
      let roomPrice = (selectedRoomIdx !== null) ? roomOptions[selectedRoomIdx].price : 0;
      if(selectedRoomIdx !== null && roomPrice>0) contract += totalRooms*roomPrice;
      let usd = 0;
      if(guideType==="kr") usd += 220;
      vangviengOptions.forEach((opt, idx) => { usd += vangviengPersons[idx]*opt.price; });
      careOptions.forEach((opt, idx) => { usd += carePersons[idx]*opt.price; });
      let extraUsd = extraUsdByPerson[personCount] ? extraUsdByPerson[personCount] * personCount : 0;
      usd += extraUsd;
      document.getElementById("contractPrice").innerText = contract.toLocaleString()+"원";
      document.getElementById("usdPrice").innerText = "$"+usd.toLocaleString();
    }

    // 최초 렌더링
    renderVangviengList();
    renderCareList();
    updateRoomList();
    updateTotal();

    // 견적 이메일 전송(여기서는 emailjs 등 외부 라이브러리 필요/이메일 직접 발송은 별도 구현)
    function submitEstimate() {
      alert("빠른 견적 보내기는 곧 지원됩니다. (별도 이메일 기능을 붙이세요!)");
    }

    // iframe 자동 높이 전송
    let lastSentHeight = 0;
    function sendHeightToParent() {
      const height = document.body.scrollHeight;
      if (window.parent !== window && lastSentHeight !== height) {
        window.parent.postMessage({
          type: "iframe-resize",
          height: height
        }, "*");
        lastSentHeight = height;
      }
    }
    window.addEventListener("load", sendHeightToParent);
    window.addEventListener("resize", sendHeightToParent);
    const observer = new MutationObserver(sendHeightToParent);
    observer.observe(document.body, { childList: true, subtree: true, attributes: true });
  </script>
</body>
</html>
