<style>
#quick-btn-wrap {
  position: fixed;
  right: 28px;
  bottom: 34px;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  gap: 16px;
  align-items: flex-end;
}
#quick-estimate-btn-global, #kakao-btn-global {
  min-width: 300px; max-width: 380px; width: 340px;
  height: 62px;
  border: none;
  border-radius: 60px;
  padding: 0 24px;
  font-size: 1.18em;
  font-weight: 700;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 2px 12px #4176a72c;
  cursor: pointer;
  outline: none;
  background: #fff;
  transition: background 0.14s, font-size .12s, color .12s;
}
#quick-estimate-btn-global {
  background: linear-gradient(90deg,#1466b6 80%, #25a6d1 100%);
  color: #fff;
  letter-spacing: -0.5px;
}
#kakao-btn-global {
  background: #ffe600;
  color: #191600;
  font-family: 'Noto Sans KR', sans-serif;
  letter-spacing: -0.5px;
}
#quick-estimate-btn-global .circle-icon,
#quick-estimate-btn-global .small-label {
  display: none;
}
#quick-estimate-btn-global .btn-text,
#kakao-btn-global .btn-text {
  width: 100%;
  text-align: center;
}
@media (max-width:700px) {
  #quick-btn-wrap {
    right: 10px;
    top: 56%;
    bottom: unset;
    transform: translateY(-50%);
    gap: 0;
    align-items: flex-end;
  }
  #quick-estimate-btn-global {
    width: 56px !important;
    min-width: 0 !important;
    max-width: none !important;
    height: 56px !important;
    border-radius: 50%;
    background: linear-gradient(90deg,#1466b6 80%, #25a6d1 100%);
    padding: 0 !important;
    font-size: 2.0em;
    box-shadow: 0 4px 18px #2978b344;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    position: relative;
  }
  #quick-estimate-btn-global .circle-icon {
    display: block;
    font-size: 1.5em;
    line-height: 1.1;
    margin-top: 2px;
    margin-bottom: 0px;
  }
  #quick-estimate-btn-global .btn-text {
    display: none;
  }
  #quick-estimate-btn-global .small-label {
    display: block;
    font-size: 0.36em;
    font-weight: 600;
    margin-top: -2px;
    letter-spacing: 0;
    color: #fff;
    line-height: 1.08;
    text-align: center;
  }
  #kakao-btn-global {
    display: none !important;
  }
}
</style>

<div id="quick-btn-wrap" style="display:none;">
  <button id="quick-estimate-btn-global" type="button" style="display:none;">
    <span class="circle-icon">📝</span>
    <span class="btn-text">즉시 견적</span>
    <span class="small-label">견적</span>
  </button>
  <button id="kakao-btn-global" type="button">
    <span class="btn-text">카카오 채널 즉시 상담</span>
  </button>
</div>

<script>
(function(){
  function updateBtnDisplay() {
    var wrap = document.getElementById('quick-btn-wrap');
    var quickBtn = document.getElementById('quick-estimate-btn-global');
    var kakaoBtn = document.getElementById('kakao-btn-global');
    var isMobile = window.innerWidth <= 700;
    var showEstimate = !!document.getElementById('cpack-quickform');
    wrap.style.display = (showEstimate || !isMobile) ? "flex" : "none";
    if (isMobile) {
      quickBtn.style.display = showEstimate ? "flex" : "none";
      kakaoBtn.style.display = "none";
    } else {
      quickBtn.style.display = showEstimate ? "flex" : "none";
      kakaoBtn.style.display = "flex";
    }
  }
  document.addEventListener("DOMContentLoaded", updateBtnDisplay);
  window.addEventListener("resize", updateBtnDisplay);
  setTimeout(updateBtnDisplay, 600);
  setInterval(updateBtnDisplay, 1500);
  document.getElementById('quick-estimate-btn-global').onclick = function(){
    var form = document.getElementById('cpack-quickform');
    if(form){
      form.scrollIntoView({ behavior: 'smooth', block: 'center' });
    }
  };
  document.getElementById('kakao-btn-global').onclick = function(){
    window.open('http://pf.kakao.com/_xoExmxfn', '_blank');
  };
})();
</script>

<!-- ============================ 빠른 견적 폼 시작 ============================ -->

<div class="container" id="cpack-quickform" style="max-width:480px;margin:32px auto;padding:24px;background:#fff;border-radius:18px;box-shadow:0 2px 14px rgba(70,85,110,0.12);">
  <h1 style="font-size:1.18rem;text-align:center;color:#14508e;font-weight:bold;margin-bottom:24px;">라오스 비엔티안(1박) - 방비엥 (2박) C-Pack 빠른견적</h1>
  <!-- 여행일자 -->
  <div class="date-section" style="margin-bottom:22px;">
    <label style="font-weight:600;color:#294a6b;font-size:0.98em;display:block;margin-bottom:8px;" for="travelDate">여행일자 <span style="font-weight:400; color:#999; font-size:0.92em;">(출국일 기준, 필수)</span></label>
    <div style="display:flex;align-items:center;background:#f4f7fb;border-radius:10px;border:1.2px solid #c5d4ee;padding:12px 13px;">
      <span style="font-size:1.2em;color:#14508e;margin-right:9px;">📅</span>
      <input type="date" id="travelDate" style="border:none;background:transparent;font-size:1em;color:#1849b9;flex:1;" required>
    </div>
  </div>
  <!-- 여행인원 -->
  <div class="section">
    <label>여행인원 <span style="font-weight:400; color:#999; font-size:0.92em;">(2~8명, 예약금 인당 60,000원)</span></label>
    <div class="toggle-group" id="personToggleGroup" style="display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;"></div>
    <div style="color:#b04d0c; font-size:0.85em; margin-top:5px; margin-bottom:-12px;">9명 이상 단체 할인 적용 가능, <b>개별 문의</b></div>
  </div>
  <!-- 가이드팩 -->
  <div class="section" style="margin-top:20px;">
    <label>가이드팩 <span style="font-weight:400; color:#999; font-size:0.92em;">(단일 선택)</span></label>
    <div class="toggle-group" id="guideToggleGroup">
      <div class="toggle-btn selected" data-guide="kr" data-price="220" style="flex:1 1 0;background:#296bb3;color:#fff;">한국인 가이드<br><span style="font-size:0.91em; color:#bbe6fa;">$220/팀</span></div>
      <div class="toggle-btn" data-guide="local" data-price="0" style="flex:1 1 0;">현지인 가이드<br><span style="font-size:0.91em; color:#55c;">추가요금 없음</span></div>
    </div>
  </div>
  <!-- 선택관광(방비엥) -->
  <div class="section" style="margin-top:20px;">
    <div class="section-label-row" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
      <label>선택관광 (방비엥)</label>
      <button type="button" class="init-btn" onclick="resetVangvieng()" style="font-size:0.92em;background:#e5eefe;border:1px solid #bdd2ea;border-radius:8px;color:#347;padding:4px 10px;cursor:pointer;margin-left:7px;">초기화</button>
    </div>
    <div class="option-list" id="vangviengList"></div>
  </div>
  <!-- 선택관광(케어팩) -->
  <div class="section">
    <div class="section-label-row" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
      <label>선택관광 (케어팩)</label>
      <button type="button" class="init-btn" onclick="resetCare()" style="font-size:0.92em;background:#e5eefe;border:1px solid #bdd2ea;border-radius:8px;color:#347;padding:4px 10px;cursor:pointer;margin-left:7px;">초기화</button>
    </div>
    <div class="option-list" id="careList"></div>
  </div>
  <!-- 숙박팩 -->
  <div class="section">
    <div class="section-label-row" style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
      <label>숙박팩</label>
      <div>
        <button type="button" class="room-single-btn" onclick="addSingleRoom()" style="background:#fff7e0; color:#b26c18; border:1px solid #edd59c; font-size:0.92em; border-radius:7px; padding:4px 12px; margin-right:7px; cursor:pointer;">싱글룸 추가</button>
        <button type="button" class="init-btn" onclick="resetSingleRoom()" style="font-size:0.92em;background:#e5eefe;border:1px solid #bdd2ea;border-radius:8px;color:#347;padding:4px 10px;cursor:pointer;margin-left:0;">초기화</button>
      </div>
    </div>
    <div class="option-list" id="roomList"></div>
  </div>
  <!-- 결과 견적 -->
  <div class="result-section" id="resultSection" style="margin:20px 0 17px 0;padding:13px 7px 8px 7px;background:#f4f6fa;border-radius:12px;text-align:center;font-size:1.05em;color:#14508e;font-weight:600;">
    계약금 (한국에서 입금하실 금액): <span id="contractPrice">0원</span><br>
    잔금 (현지에서 달러 지불하실 금액): <span id="usdPrice">$0</span>
  </div>
  <!-- 연락처 정보 -->
  <div class="contact-section" style="margin-bottom:20px;background:#f9fafb;border-radius:12px;padding:12px 8px 7px 8px;">
    <label class="contact-label" for="contactName" style="display:block;margin:10px 0 5px 2px;color:#37629d;font-size:0.96em;font-weight:500;">대표자 성함 <span style="color:#d02b2b;">*</span></label>
    <input type="text" class="contact-input" id="contactName" placeholder="대표자 이름을 입력하세요" required style="width:100%;padding:8px 8px;border:1px solid #bfd2e9;border-radius:8px;font-size:1em;margin-bottom:3px;box-sizing:border-box;background:#f7fafc;">
    <label class="contact-label" for="contactPhone" style="display:block;margin:10px 0 5px 2px;color:#37629d;font-size:0.96em;font-weight:500;">연락 가능한 번호 또는 카카오톡 ID <span style="color:#d02b2b;">*</span></label>
    <input type="text" class="contact-input" id="contactPhone" placeholder="휴대폰 번호 또는 카카오톡 ID" required style="width:100%;padding:8px 8px;border:1px solid #bfd2e9;border-radius:8px;font-size:1em;margin-bottom:3px;box-sizing:border-box;background:#f7fafc;">
    <label class="contact-label" for="contactNote" style="display:block;margin:10px 0 5px 2px;color:#37629d;font-size:0.96em;font-weight:500;">기타 요청 사항 (선택)</label>
    <textarea class="contact-input" id="contactNote" rows="2" placeholder="예 ) 예약 관련 특이사항, 식단, 선택관광에 없는 추가 희망 일정 등" style="width:100%;padding:8px 8px;border:1px solid #bfd2e9;border-radius:8px;font-size:1em;margin-bottom:3px;box-sizing:border-box;background:#f7fafc;"></textarea>
  </div>
  <button class="submit-btn" onclick="submitEstimate()" style="display:block;width:100%;background:linear-gradient(90deg,#1466b6 88%, #25a6d1 100%);color:#fff;border:none;border-radius:12px;padding:13px 0;font-size:1em;font-weight:700;margin-top:22px;cursor:pointer;letter-spacing:0.5px;box-shadow:0 2px 10px #4176a72c;">빠른 견적 보내기</button>
</div>
<!-- ============================ 빠른 견적 폼 끝 ============================ -->

<script>
const MAX_PERSON = 8;
const extraUsdByPerson = {8:95,7:105,6:118,5:137,4:165,3:211,2:305};
const vangviengOptions = [
  {name: "열기구", price: 100},
  {name: "페러모터", price: 85},
  {name: "버기카", price: 18},
  {name: "짚라인", price: 20},
  {name: "롱테일보트", price: 10},
  {name: "시크릿라군", price: 10}
];
const careOptions = [
  {name: "베트남식 이발관 풀코스 (90분)", price: 30},
  {name: "라오 허벌 테라피", price: 40},
  {name: "라오 전통 마사지 (2시간)", price: 25},
  {name: "라오 전통 마사지 (1시간)", price: 13},
  {name: "라오 오일 마사지 (2시간)", price: 35},
  {name: "라오 오일 마사지 (1시간)", price: 20}
];
const roomOptions = [
  {name: "5성급 3박", price: 255000},
  {name: "4성급 3박", price: 159000},
  {name: "제가 예약할게요", price: 0}
];
const personToggleGroup = document.getElementById("personToggleGroup");
let personCount = 2;
for(let i=2; i<=MAX_PERSON; i++) {
  const btn = document.createElement("div");
  btn.className = "toggle-btn" + (i===2 ? " selected" : "");
  btn.innerText = i + "명";
  btn.setAttribute('data-person', i);
  btn.style.flex = "1 1 0";
  btn.onclick = function() {
    document.querySelectorAll("#personToggleGroup .toggle-btn").forEach(b=>b.classList.remove("selected"));
    btn.classList.add("selected");
    personCount = i;
    vangviengPersons = vangviengPersons.map((v,idx)=>vangviengChecked[idx]?personCount:0);
    carePersons = carePersons.map((v,idx)=>careChecked[idx]?personCount:0);
    updateRoomList();
    renderVangviengList();
    renderCareList();
    updateTotal();
    sendHeightToParent();
  }
  personToggleGroup.appendChild(btn);
}
let guideType = "kr";
let guidePrice = 220;
document.querySelectorAll("#guideToggleGroup .toggle-btn").forEach(btn=>{
  btn.onclick = function(){
    document.querySelectorAll("#guideToggleGroup .toggle-btn").forEach(b=>b.classList.remove("selected"));
    btn.classList.add("selected");
    guideType = btn.getAttribute('data-guide');
    guidePrice = Number(btn.getAttribute('data-price'));
    updateTotal();
    sendHeightToParent();
  }
});
// 선택관광(방비엥) 버튼화
const vangviengList = document.getElementById("vangviengList");
let vangviengChecked = Array(vangviengOptions.length).fill(false);
let vangviengPersons = Array(vangviengOptions.length).fill(0);
function renderVangviengList() {
  vangviengList.innerHTML = "";
  vangviengOptions.forEach((opt, idx) => {
    const row = document.createElement("div");
    row.className = "option-row" + (vangviengChecked[idx] ? " selected" : "");
    row.style.cursor = "pointer";
    row.onclick = function(){
      vangviengChecked[idx] = !vangviengChecked[idx];
      vangviengPersons[idx] = vangviengChecked[idx] ? personCount : 0;
      renderVangviengList();
      updateTotal();
      sendHeightToParent();
    };
    const title = document.createElement("div");
    title.className = "option-title";
    title.innerText = opt.name;
    row.appendChild(title);
    const unit = document.createElement("div");
    unit.className = "option-unit";
    if(vangviengChecked[idx]) {
      unit.innerText = `$${opt.price} × ${vangviengPersons[idx]}명 = $${vangviengPersons[idx]*opt.price}`;
    } else {
      unit.innerText = `$${opt.price}/인당`;
    }
    row.appendChild(unit);
    const controls = document.createElement("div");
    controls.className = "option-controls";
    if(vangviengChecked[idx]) {
      const minusBtn = document.createElement("button");
      minusBtn.type = "button";
      minusBtn.className = "option-minus-btn";
      minusBtn.innerText = "-1명";
      minusBtn.onclick = function(e){
        vangviengPersons[idx] = Math.max(0, vangviengPersons[idx]-1);
        if(vangviengPersons[idx]===0) {
          vangviengChecked[idx]=false;
        }
        renderVangviengList();
        updateTotal();
        sendHeightToParent();
        e.stopPropagation(); // row 클릭 이벤트 방지
      };
      controls.appendChild(minusBtn);
      const total = document.createElement("div");
      total.className = "option-total";
      total.id = "vvTotal"+idx;
      total.innerText = `$${vangviengPersons[idx]*opt.price} / 총 ${vangviengPersons[idx]}명`;
      controls.appendChild(total);
    }
    row.appendChild(controls);
    vangviengList.appendChild(row);
  });
}
window.resetVangvieng = function(){
  vangviengChecked = vangviengChecked.map(()=>false);
  vangviengPersons = vangviengPersons.map(()=>0);
  renderVangviengList();
  updateTotal();
  sendHeightToParent();
}
// 선택관광(케어팩) 버튼화
const careList = document.getElementById("careList");
let careChecked = Array(careOptions.length).fill(false);
let carePersons = Array(careOptions.length).fill(0);
function renderCareList() {
  careList.innerHTML = "";
  careOptions.forEach((opt, idx) => {
    const row = document.createElement("div");
    row.className = "option-row" + (careChecked[idx] ? " selected" : "");
    row.style.cursor = "pointer";
    row.onclick = function(){
      careChecked[idx] = !careChecked[idx];
      carePersons[idx] = careChecked[idx] ? personCount : 0;
      renderCareList();
      updateTotal();
      sendHeightToParent();
    };
    const title = document.createElement("div");
    title.className = "option-title";
    title.innerText = opt.name;
    row.appendChild(title);
    const unit = document.createElement("div");
    unit.className = "option-unit";
    if(careChecked[idx]) {
      unit.innerText = `$${opt.price} × ${carePersons[idx]}명 = $${carePersons[idx]*opt.price}`;
    } else {
      unit.innerText = `$${opt.price}/인당`;
    }
    row.appendChild(unit);
    const controls = document.createElement("div");
    controls.className = "option-controls";
    if(careChecked[idx]) {
      const minusBtn = document.createElement("button");
      minusBtn.type = "button";
      minusBtn.className = "option-minus-btn";
      minusBtn.innerText = "-1명";
      minusBtn.onclick = function(e){
        carePersons[idx] = Math.max(0, carePersons[idx]-1);
        if(carePersons[idx]===0) {
          careChecked[idx]=false;
        }
        renderCareList();
        updateTotal();
        sendHeightToParent();
        e.stopPropagation();
      };
      controls.appendChild(minusBtn);
      const total = document.createElement("div");
      total.className = "option-total";
      total.id = "careTotal"+idx;
      total.innerText = `$${carePersons[idx]*opt.price} / 총 ${carePersons[idx]}명`;
      controls.appendChild(total);
    }
    row.appendChild(controls);
    careList.appendChild(row);
  });
}
window.resetCare = function(){
  careChecked = careChecked.map(()=>false);
  carePersons = carePersons.map(()=>0);
  renderCareList();
  updateTotal();
  sendHeightToParent();
}
// 숙박팩(버튼화, 단일선택)
const roomList = document.getElementById("roomList");
let selectedRoomIdx = null;
let singleRoomAdd = 0;
function updateRoomList(){
  roomList.innerHTML = "";
  let baseRoomCnt = Math.ceil(personCount/2);
  let totalRooms = baseRoomCnt + singleRoomAdd;
  roomOptions.forEach((opt, idx) => {
    const row = document.createElement("div");
    row.className = "option-row" + (selectedRoomIdx === idx ? " selected" : "");
    row.style.cursor = "pointer";
    row.onclick = function(){
      if(selectedRoomIdx === idx){
        selectedRoomIdx = null;
      } else {
        selectedRoomIdx = idx;
      }
      updateRoomList();
      updateTotal();
      sendHeightToParent();
    };
    const title = document.createElement("div");
    title.className = "option-title";
    title.innerText = opt.name;
    const unit = document.createElement("div");
    unit.className = "option-unit";
    if(opt.price===0){
      unit.innerText = "0원";
    } else {
      unit.innerText = `${opt.price.toLocaleString()}원/객실`;
    }
    const total = document.createElement("div");
    total.className = "option-total";
    total.id = "roomTotal"+idx;
    if(opt.price===0){
      total.innerText = "0원";
    } else {
      total.innerText = `${(totalRooms*opt.price).toLocaleString()}원 / ${totalRooms}객실`;
    }
    row.appendChild(title);
    row.appendChild(unit);
    row.appendChild(total);
    roomList.appendChild(row);
  });
}
window.addSingleRoom = function(){
  singleRoomAdd += 1;
  updateRoomList();
  updateTotal();
  sendHeightToParent();
}
window.resetSingleRoom = function(){
  singleRoomAdd = 0;
  selectedRoomIdx = null;
  updateRoomList();
  updateTotal();
  sendHeightToParent();
}
function updateTotal(){
  let contract = personCount * 60000;
  let baseRoomCnt = Math.ceil(personCount/2);
  let totalRooms = baseRoomCnt + singleRoomAdd;
  let roomPrice = (selectedRoomIdx !== null) ? roomOptions[selectedRoomIdx].price : 0;
  if(selectedRoomIdx !== null && roomPrice>0) contract += totalRooms*roomPrice;
  let usd = 0;
  if(guideType==="kr") usd += 220;
  vangviengOptions.forEach((opt, idx) => { usd += vangviengPersons[idx]*opt.price; });
  careOptions.forEach((opt, idx) => { usd += carePersons[idx]*opt.price; });
  let extraUsd = extraUsdByPerson[personCount] ? extraUsdByPerson[personCount] * personCount : 0;
  usd += extraUsd;
  document.getElementById("contractPrice").innerText = contract.toLocaleString()+"원";
  document.getElementById("usdPrice").innerText = "$"+usd.toLocaleString();
}
renderVangviengList();
renderCareList();
updateRoomList();
updateTotal();
// 견적 전송 예시 (EmailJS 등 실제 전송 코드로 교체 필요)
function submitEstimate() {
  alert('빠른 견적 전송은 데모입니다.\n(실제 이메일 연동 필요)');
}
// 자동 높이 parent에 전달 (iframe용)
function sendHeightToParent() {
  if (window.parent !== window) {
    window.parent.postMessage({
      type: "iframe-resize",
      height: document.body.scrollHeight
    }, "*");
  }
}
window.addEventListener("load", sendHeightToParent);
window.addEventListener("resize", sendHeightToParent);
const observer = new MutationObserver(sendHeightToParent);
observer.observe(document.body, { childList: true, subtree: true, attributes: true });
</script>
