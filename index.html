<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>라오스 비엔티안(1박) - 방비엥 (2박) C-Pack 빠른견적</title>
  <meta name="viewport" content="width=480,user-scalable=no">
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function(){ emailjs.init('luKxEKdyyvY4hjYfo'); })();
  </script>
  <style>
    html { font-size:15px;}
    body { font-family: 'Pretendard', 'Noto Sans KR', Arial, sans-serif; background: #f7f7fa; margin: 0; padding: 0; color: #222; font-size:1rem;}
    .container { max-width: 880px; margin:32px auto; padding: 24px; background: #fff; border-radius: 18px; box-shadow: 0 2px 14px rgba(70, 85, 110, 0.12); }

    /* 2단 컬럼 (PC) */
    .form-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 32px;
    }
    .form-col {
      flex: 1 1 0;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 0;
    }
    .form-col.left {
      min-width: 300px; /* 필요시 조정 */
      flex-basis: 48%;
    }
    .form-col.right {
      min-width: 300px;
      flex-basis: 48%;
    }

    .section, .date-section, .result-section, .contact-section { margin-bottom: 24px; }
    h1 { font-size: 1.18rem; font-weight: bold; text-align: center; margin-bottom: 24px; color: #14508e; letter-spacing: -1px;}
    .result-section .result-title {
      font-size: 1.21em;
      font-weight: bold;
      color: #17508e;
      margin-bottom: 2px;
    }
    .result-section .result-desc {
      font-size: 0.95em;
      color: #989898;
      margin-bottom: 10px;
    }
    .result-section .result-big {
      font-size: 1.5em;
      font-weight: 700;
      color: #d02b2b;
      margin-left: 3px;
      display: inline-block;
    }

    /* 숙박팩 가격 컬러 */
    .room-price-blue { color: #1559d4 !important; font-weight: bold;}
    .room-total-red { color: #d02b2b !important; font-weight: bold;}

    /* 선택관광 인당 가격(파랑) */
    .price-blue { color: #1559d4 !important; font-weight: bold; }

    /* 전체 볼드화 */
    .section-label-row, .option-title, .option-unit, .option-total, .toggle-btn,
    .contact-label, .contact-input, .person-desc, label { font-weight: bold;}

    /* 숙박팩 버튼 우측 정렬 (싱글룸/초기화) */
    .section-label-row { display: flex; justify-content: space-between; align-items: center; }
    .option-row { position: relative; }

    /* 선택관광 -1명 버튼 위치 */
    .option-controls { position: absolute; right: 12px; top: 10px; z-index:2; }
    .option-minus-btn { font-size: 1em; padding: 4px 10px; border-radius:7px; background:#e9e7ff; color:#2857a3; border:1px solid #bdd2ea; cursor:pointer;}
    .option-minus-btn:active { background:#c9e2ff;}

    .option-total {
      position: absolute;
      right: 10px;
      bottom: 9px;
      color: #d02b2b;
      font-size: 1.07em;
      background: none; border: none; margin: 0; font-weight: bold;
    }
    /* 선택 안된 상태 인당 가격 파랑(PC) */
    .option-unit.price-blue { color: #1559d4 !important; font-weight: bold;}

    .contact-section {
      background: #f9fafb !important;
      border-radius: 12px !important;
      padding: 12px 8px 7px 8px !important;
      font-weight: bold;
    }

    /* 모바일에서 1단으로 변경 */
    @media (max-width: 900px) {
      .container { max-width: 99vw; padding: 7vw 2vw;}
      .form-grid { flex-direction: column; gap: 0;}
      .form-col.left, .form-col.right { flex-basis: 100%; min-width: 0;}
    }
    @media (max-width:700px) {
      /* 소제목, 블록 등 크게 */
      .section-label-row label, .date-label, .result-title { font-size: 1.35em !important; }
      .option-title, .option-unit, .option-total, .toggle-btn { font-size: 1.11em !important; }
      .section, .date-section, .result-section, .contact-section, .option-row { font-weight: bold; }
      .option-row { min-height: 38px !important; font-size: 1em;}
      .option-controls { right: 8px; top: 7px; }
      .option-minus-btn { font-size: 1.16em !important; padding: 1px 11px !important;}
      .option-total { font-size: 1.22em !important; bottom: 6px;}
      /* 선택 전 인당 가격 폰트 */
      .option-unit.price-blue { font-size: 1.1em !important; }
    }
    /* 숙박팩 - 객실 가격(파랑), 총가격(빨강) */
    .room-price-blue { color: #1559d4 !important; font-weight: bold;}
    .room-total-red { color: #d02b2b !important; font-weight: bold;}
  </style>
</head>
<body>

<div class="container" id="cpack-quickform">
  <h1>라오스 비엔티안(1박) - 방비엥 (2박) C-Pack 빠른견적</h1>
  <div class="form-grid">
    <!-- 왼쪽 컬럼: 날짜, 인원, 가이드, 방비엥, 케어팩 -->
    <div class="form-col left">
      <div class="date-section">
        <label class="date-label" for="travelDate">여행일자 <span style="font-weight:400; color:#999; font-size:0.92em;">(출국일 기준, 필수)</span></label>
        <div class="date-input-wrap">
          <span class="date-icon">📅</span>
          <input type="date" id="travelDate" class="date-input" required>
        </div>
      </div>
      <div class="section">
        <label>여행인원 <span style="font-weight:400; color:#999; font-size:0.92em;">(2~8명, 예약금 인당 60,000원)</span></label>
        <div class="toggle-group" id="personToggleGroup"></div>
        <div class="person-desc">9명 이상 단체 할인 적용 가능, <b>개별 문의</b></div>
      </div>
      <div class="section">
        <label>가이드팩 <span style="font-weight:400; color:#999; font-size:0.92em;">(단일 선택)</span></label>
        <div class="toggle-group" id="guideToggleGroup">
          <div class="toggle-btn selected" data-guide="kr" data-price="220">한국인 가이드<br><span style="font-size:0.91em; color:#bbe6fa;">$220/팀</span></div>
          <div class="toggle-btn" data-guide="local" data-price="0">현지인 가이드<br><span style="font-size:0.91em; color:#55c;">추가요금 없음</span></div>
        </div>
      </div>
      <div class="section">
        <div class="section-label-row">
          <label>선택관광 (방비엥)</label>
          <button type="button" class="init-btn" onclick="resetVangvieng()">초기화</button>
        </div>
        <div class="option-list" id="vangviengList"></div>
      </div>
      <div class="section">
        <div class="section-label-row">
          <label>선택관광 (케어팩)</label>
          <button type="button" class="init-btn" onclick="resetCare()">초기화</button>
        </div>
        <div class="option-list" id="careList"></div>
      </div>
    </div>
    <!-- 오른쪽 컬럼: 숙박, 결과, 연락처, 제출 -->
    <div class="form-col right">
      <div class="section">
        <div class="section-label-row">
          <label>숙박팩</label>
          <div>
            <button type="button" class="room-single-btn" onclick="addSingleRoom()">싱글룸 추가</button>
            <button type="button" class="init-btn" onclick="resetSingleRoom()">초기화</button>
          </div>
        </div>
        <div class="option-list" id="roomList"></div>
      </div>
      <div class="result-section" id="resultSection">
        <div class="result-title">빠른 견적 금액</div>
        <div class="result-desc">(실제 견적과 상이할 수 있습니다.)</div>
        계약금 (한국에서 입금하실 금액): 
        <span id="contractPrice" class="result-big"></span><br>
        잔금 (현지에서 달러 지불하실 금액): 
        <span id="usdPrice" class="result-big"></span>
      </div>
      <div class="contact-section">
        <label class="contact-label" for="contactName">대표자 성함 <span style="color:#d02b2b;">*</span></label>
        <input type="text" class="contact-input" id="contactName" placeholder="대표자 이름을 입력하세요" required>
        <label class="contact-label" for="contactPhone">연락 가능한 번호 또는 카카오톡 ID <span style="color:#d02b2b;">*</span></label>
        <input type="text" class="contact-input" id="contactPhone" placeholder="휴대폰 번호 또는 카카오톡 ID" required>
        <label class="contact-label" for="contactNote">기타 요청 사항 (선택)</label>
        <textarea class="contact-input" id="contactNote" rows="2" placeholder="예 ) 예약 관련 특이사항, 식단, 선택관광에 없는 추가 희망 일정 등"></textarea>
      </div>
      <button class="submit-btn" onclick="submitEstimate()">빠른 견적 보내기</button>
    </div>
  </div>
</div>
<script>
const MAX_PERSON = 8;
const extraUsdByPerson = {8:95,7:105,6:118,5:137,4:165,3:211,2:305};
const vangviengOptions = [
  {name: "열기구", price: 100},
  {name: "페러모터", price: 85},
  {name: "버기카", price: 18},
  {name: "짚라인", price: 20},
  {name: "롱테일보트", price: 10},
  {name: "시크릿라군", price: 10}
];
const careOptions = [
  {name: "베트남식 이발관 풀코스 (90분)", price: 30},
  {name: "라오 허벌 테라피", price: 40},
  {name: "라오 전통 마사지 (2시간)", price: 25},
  {name: "라오 전통 마사지 (1시간)", price: 13},
  {name: "라오 오일 마사지 (2시간)", price: 35},
  {name: "라오 오일 마사지 (1시간)", price: 20}
];
const roomOptions = [
  {name: "5성급 3박", price: 255000},
  {name: "4성급 3박", price: 159000},
  {name: "제가 예약할게요", price: 0}
];
const personToggleGroup = document.getElementById("personToggleGroup");
let personCount = 2;
for(let i=2; i<=MAX_PERSON; i++) {
  const btn = document.createElement("div");
  btn.className = "toggle-btn" + (i===2 ? " selected" : "");
  btn.innerText = i + "명";
  btn.setAttribute('data-person', i);
  btn.onclick = function() {
    document.querySelectorAll("#personToggleGroup .toggle-btn").forEach(b=>b.classList.remove("selected"));
    btn.classList.add("selected");
    personCount = i;
    vangviengPersons = vangviengPersons.map((v,idx)=>vangviengChecked[idx]?personCount:0);
    carePersons = carePersons.map((v,idx)=>careChecked[idx]?personCount:0);
    updateRoomList();
    renderVangviengList();
    renderCareList();
    updateTotal();
    sendHeightToParent();
  }
  personToggleGroup.appendChild(btn);
}
let guideType = "kr";
let guidePrice = 220;
document.querySelectorAll("#guideToggleGroup .toggle-btn").forEach(btn=>{
  btn.onclick = function(){
    document.querySelectorAll("#guideToggleGroup .toggle-btn").forEach(b=>b.classList.remove("selected"));
    btn.classList.add("selected");
    guideType = btn.getAttribute('data-guide');
    guidePrice = Number(btn.getAttribute('data-price'));
    updateTotal();
    sendHeightToParent();
  }
});
// 선택관광(방비엥) 버튼화
const vangviengList = document.getElementById("vangviengList");
let vangviengChecked = Array(vangviengOptions.length).fill(false);
let vangviengPersons = Array(vangviengOptions.length).fill(0);
function renderVangviengList() {
  vangviengList.innerHTML = "";
  vangviengOptions.forEach((opt, idx) => {
    const row = document.createElement("div");
    row.className = "option-row" + (vangviengChecked[idx] ? " selected" : "");
    row.style.cursor = "pointer";
    row.onclick = function(){
      vangviengChecked[idx] = !vangviengChecked[idx];
      vangviengPersons[idx] = vangviengChecked[idx] ? personCount : 0;
      renderVangviengList();
      updateTotal();
      sendHeightToParent();
    };
    const title = document.createElement("div");
    title.className = "option-title";
    title.innerText = opt.name;
    row.appendChild(title);

    // 인당 가격(파랑, 미선택시)
    const unit = document.createElement("div");
    unit.className = "option-unit" + (!vangviengChecked[idx] ? " price-blue" : "");
    if(vangviengChecked[idx]) {
      unit.innerText = `$${opt.price} × ${vangviengPersons[idx]}명 = $${vangviengPersons[idx]*opt.price}`;
    } else {
      unit.innerText = `$${opt.price}/인당`;
    }
    row.appendChild(unit);

    // -1명 버튼, 총 가격
    if(vangviengChecked[idx]) {
      const controls = document.createElement("div");
      controls.className = "option-controls";
      const minusBtn = document.createElement("button");
      minusBtn.type = "button";
      minusBtn.className = "option-minus-btn";
      minusBtn.innerText = "-1명";
      minusBtn.onclick = function(e){
        vangviengPersons[idx] = Math.max(0, vangviengPersons[idx]-1);
        if(vangviengPersons[idx]===0) vangviengChecked[idx]=false;
        renderVangviengList(); updateTotal(); sendHeightToParent();
        e.stopPropagation();
      };
      controls.appendChild(minusBtn);
      row.appendChild(controls);

      const total = document.createElement("div");
      total.className = "option-total";
      total.id = "vvTotal"+idx;
      total.innerText = `$${vangviengPersons[idx]*opt.price} / 총 ${vangviengPersons[idx]}명`;
      row.appendChild(total);
    }
    vangviengList.appendChild(row);
  });
}
window.resetVangvieng = function(){
  vangviengChecked = vangviengChecked.map(()=>false);
  vangviengPersons = vangviengPersons.map(()=>0);
  renderVangviengList();
  updateTotal();
  sendHeightToParent();
}
// 선택관광(케어팩) 버튼화
const careList = document.getElementById("careList");
let careChecked = Array(careOptions.length).fill(false);
let carePersons = Array(careOptions.length).fill(0);
function renderCareList() {
  careList.innerHTML = "";
  careOptions.forEach((opt, idx) => {
    const row = document.createElement("div");
    row.className = "option-row" + (careChecked[idx] ? " selected" : "");
    row.style.cursor = "pointer";
    row.onclick = function(){
      careChecked[idx] = !careChecked[idx];
      carePersons[idx] = careChecked[idx] ? personCount : 0;
      renderCareList();
      updateTotal();
      sendHeightToParent();
    };
    const title = document.createElement("div");
    title.className = "option-title";
    title.innerText = opt.name;
    row.appendChild(title);

    const unit = document.createElement("div");
    unit.className = "option-unit" + (!careChecked[idx] ? " price-blue" : "");
    if(careChecked[idx]) {
      unit.innerText = `$${opt.price} × ${carePersons[idx]}명 = $${carePersons[idx]*opt.price}`;
    } else {
      unit.innerText = `$${opt.price}/인당`;
    }
    row.appendChild(unit);

    if(careChecked[idx]) {
      const controls = document.createElement("div");
      controls.className = "option-controls";
      const minusBtn = document.createElement("button");
      minusBtn.type = "button";
      minusBtn.className = "option-minus-btn";
      minusBtn.innerText = "-1명";
      minusBtn.onclick = function(e){
        carePersons[idx] = Math.max(0, carePersons[idx]-1);
        if(carePersons[idx]===0) careChecked[idx]=false;
        renderCareList(); updateTotal(); sendHeightToParent();
        e.stopPropagation();
      };
      controls.appendChild(minusBtn);
      row.appendChild(controls);

      const total = document.createElement("div");
      total.className = "option-total";
      total.id = "careTotal"+idx;
      total.innerText = `$${carePersons[idx]*opt.price} / 총 ${carePersons[idx]}명`;
      row.appendChild(total);
    }
    careList.appendChild(row);
  });
}
window.resetCare = function(){
  careChecked = careChecked.map(()=>false);
  carePersons = carePersons.map(()=>0);
  renderCareList();
  updateTotal();
  sendHeightToParent();
}
// 숙박팩(버튼화, 단일선택)
const roomList = document.getElementById("roomList");
let selectedRoomIdx = null;
let singleRoomAdd = 0;
function updateRoomList(){
  roomList.innerHTML = "";
  let baseRoomCnt = Math.ceil(personCount/2);
  let totalRooms = baseRoomCnt + singleRoomAdd;
  roomOptions.forEach((opt, idx) => {
    const row = document.createElement("div");
    row.className = "option-row" + (selectedRoomIdx === idx ? " selected" : "");
    row.style.cursor = "pointer";
    row.onclick = function(){
      if(selectedRoomIdx === idx){
        selectedRoomIdx = null;
      } else {
        selectedRoomIdx = idx;
      }
      updateRoomList();
      updateTotal();
      sendHeightToParent();
    };
    const title = document.createElement("div");
    title.className = "option-title";
    title.innerText = opt.name;
    // 객실당 가격 (파랑)
    const unit = document.createElement("div");
    unit.className = "option-unit room-price-blue";
    unit.innerText = opt.price === 0 ? "0원" : `${opt.price.toLocaleString()}원/객실`;
    // 총 가격 (빨강)
    const total = document.createElement("div");
    total.className = "option-total room-total-red";
    total.id = "roomTotal"+idx;
    if(opt.price===0){
      total.innerText = "0원";
    } else {
      total.innerText = `${(totalRooms*opt.price).toLocaleString()}원 / ${totalRooms}객실`;
    }
    row.appendChild(title);
    row.appendChild(unit);
    row.appendChild(total);
    roomList.appendChild(row);
  });
}
window.addSingleRoom = function(){
  singleRoomAdd += 1;
  updateRoomList();
  updateTotal();
  sendHeightToParent();
}
window.resetSingleRoom = function(){
  singleRoomAdd = 0;
  selectedRoomIdx = null;
  updateRoomList();
  updateTotal();
  sendHeightToParent();
}
function updateTotal(){
  let contract = personCount * 60000;
  let baseRoomCnt = Math.ceil(personCount/2);
  let totalRooms = baseRoomCnt + singleRoomAdd;
  let roomPrice = (selectedRoomIdx !== null) ? roomOptions[selectedRoomIdx].price : 0;
  if(selectedRoomIdx !== null && roomPrice>0) contract += totalRooms*roomPrice;
  let usd = 0;
  if(guideType==="kr") usd += 220;
  vangviengOptions.forEach((opt, idx) => { usd += vangviengPersons[idx]*opt.price; });
  careOptions.forEach((opt, idx) => { usd += carePersons[idx]*opt.price; });
  let extraUsd = extraUsdByPerson[personCount] ? extraUsdByPerson[personCount] * personCount : 0;
  usd += extraUsd;
  document.getElementById("contractPrice").innerText = contract.toLocaleString()+"원";
  document.getElementById("usdPrice").innerText = "$"+usd.toLocaleString();
}
renderVangviengList();
renderCareList();
updateRoomList();
updateTotal();
// 견적 전송 (EmailJS)
function submitEstimate() {
  const travelDate = document.getElementById("travelDate").value.trim();
  if(!travelDate) { alert("여행일자를 선택해주세요."); document.getElementById("travelDate").focus(); return;}
  const name = document.getElementById("contactName").value.trim();
  const phone = document.getElementById("contactPhone").value.trim();
  const note = document.getElementById("contactNote").value.trim();
  if(!name) { alert("대표자 성함을 입력해주세요."); document.getElementById("contactName").focus(); return;}
  if(!phone) { alert("연락 가능한 번호 또는 카카오톡 ID를 입력해주세요."); document.getElementById("contactPhone").focus(); return;}
  let persons = personCount + "명";
  let guide = guideType === "kr" ? "한국인 가이드 ($220/팀)" : "현지인 가이드 (추가요금 없음)";
  let vangStr = vangviengOptions.map((opt, i)=> vangviengPersons[i]>0? `${opt.name} (${vangviengPersons[i]}명)`:'').filter(Boolean).join(', ') || '없음';
  let careStr = careOptions.map((opt, i)=> carePersons[i]>0? `${opt.name} (${carePersons[i]}명)`:'').filter(Boolean).join(', ') || '없음';
  let baseRoomCnt = Math.ceil(personCount/2);
  let totalRooms = baseRoomCnt + singleRoomAdd;
  let roomStr = selectedRoomIdx!==null ? roomOptions[selectedRoomIdx].name : "미선택";
  if(selectedRoomIdx!==null && roomOptions[selectedRoomIdx].price!==0) roomStr += ` (${totalRooms}객실)`;
  let contract = document.getElementById("contractPrice").innerText;
  let usd = document.getElementById("usdPrice").innerText;
  emailjs.send('service_e6uns2x', 'template_hhk1zot', {
    travel_date: travelDate,
    name: name,
    phone: phone,
    persons: persons,
    guide: guide,
    vangvieng: vangStr,
    care: careStr,
    room: roomStr,
    contract: contract,
    usd: usd,
    note: note
  }).then(function(response) {
    alert("견적이 성공적으로 전송되었습니다!");
  }, function(error) {
    alert("견적 전송에 실패했습니다. 잠시 후 다시 시도해주세요.");
  });
}
// iframe 자동 높이 parent로 전달
function sendHeightToParent() {
  if (window.parent !== window) {
    window.parent.postMessage({
      type: "iframe-resize",
      height: document.body.scrollHeight
    }, "*");
  }
}
window.addEventListener("load", sendHeightToParent);
window.addEventListener("resize", sendHeightToParent);
const observer = new MutationObserver(sendHeightToParent);
observer.observe(document.body, { childList: true, subtree: true, attributes: true });
</script>
</body>
</html>
